<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TribeAly ‚Äî 25¬∞ATMIA</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,600;1,700&family=Cormorant+Garamond:ital,wght@1,600;1,700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- GATE: Codename + First-time Secret Key -->
  <div id="gate" class="gate">
    <div class="gate-panel" id="gatePanel">
      <label class="field">
        <span>Codename</span>
        <input id="codenameInput" type="text" placeholder="check your invite text üëÄ" autocomplete="off" />
      </label>

      <div id="keyRow" class="field">
        <span>Secret Keyüîë </span>
        <input id="keyInput" type="password" placeholder="hint: what hashtags did you see?" />
      </div>

      <button id="enterBtn" class="btn primary" type="button">Enter</button>
      <p id="gateMsg" class="gate-msg" role="alert"></p>
      <p class="hint">Psst: number of tries might matter üòù treealy</p>
    </div>
  </div>

  <div id="reveal" class="reveal-layer" aria-hidden="true">
    <div id="revealTitle" class="reveal-title">
      <p>Welcome to</p>
      <h1 class="logo" data-text="TribeAly">TribeAly</h1>
      <p class="tag">Ready to go MIA with me AT 25¬∞?</p>
    </div>
  </div>

  
  <!-- Top bar -->
  <header id="topbar" class="topbar">
    <div class="brand">
      <span class="sunset">‚òº</span> TribeAly
      <small class="sub">25¬∞ ‚Ä¢ MIA</small>
    </div>
    <div class="session">
      <span id="helloName"></span>
      <button id="logoutBtn" class="btn ghost">Log Out</button>
    </div>
  </header>

  <!-- Grid of 12 cards -->
  <main id="main" class="app hidden wrap">
    <!-- Top 4 small -->
    <section class="grid">
      <!-- Location -->
      <article class="card small" data-card="location">
        <div class="inner">
          <div class="face front" style="--icon-w: 220px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/location.png" alt="Location">
          </div>
          <div class="face back">
            <h3>Our Villa</h3>
            <div class="gallery" id="villaGallery">
              <img src="assets/villa/swimming_pool.png" alt="Villa pool">
              <img src="assets/villa/living_room.png" alt="Lounge">
              <img src="assets/villa/bedroom.png" alt="Bedroom">
            </div>
            <!-- bottom action row -->
            <div class="card-actions">
              <button class="expand-btn" data-open="villaModal" aria-haspopup="dialog">
                View full details
              </button>
            </div>
          </div>
        </div>
      </article>

      <!-- Pop-out modal for Location -->
      <dialog id="villaModal" class="modal">
        <div class="modal-card">
          <header class="modal-head">
            <h4>Villa ‚Äî Club 25¬∞</h4>
            <button class="close-modal" aria-label="Close">‚úï</button>
          </header>

          <section class="modal-body">
            <!-- Large gallery -->
            <div class="grid-gallery">
              <img src="assets/villa/bed.png" alt="Bed">
              <img src="assets/villa/living_room.png" alt="Lounge">
              <img src="assets/villa/dining.png" alt="Dining">
              <img src="assets/villa/fireplace.png" alt="Fireplace">
              <img src="assets/villa/bedroom.png" alt="Bedroom">
              <img src="assets/villa/swimming_pool.png" alt="SwimmingPool">
            </div>

            <div class="villa-details">
              <p><strong>Address:</strong> Near South Beach, Miami, FL (TBD after RSVP)</p>
              <p><strong>Amenities:</strong> Heated pool, 6BR/4BA, Chef-ready kitchen</p>
              <p><strong>House rules:</strong></p>
              <ul class="bullets">
                <li>No glass near the pool</li>
                <li>Lock doors, close gates</li>
                <li>Be kind, be inclusive</li>
              </ul> 
            </div>
          </section>
        </div>
      </dialog>

      <!-- Suitcase -->
      <article class="card small" data-card="pack">
        <div class="inner">
          <div class="face front" style="--icon-w: 220px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/suitcase.png" alt="Suitcase">
          </div>
          <div class="face back">
            <h3>What Should I Pack?</h3>
            <div class="row gap">
              <button id="printPackBtn1" class="btn">Save Packing List as PDF</button>
            </div>
            <!-- bottom action row -->
            <div class="card-actions">
              <button class="expand-btn" data-open="suitcaseModal" aria-haspopup="dialog">
                View full details
              </button>
            </div>
          </div>
        </div>
      </article>

      <!-- Pop-out modal for Suitcase -->
      <dialog id="suitcaseModal" class="modal">
        <div class="modal-card">
          <header class="modal-head">
            <h4>Pack List</h4>
            <button class="close-modal" aria-label="Close">‚úï</button>
          </header>

          <section class="modal-body">
            <div class="villa-details">
              <ul id="packList" class="checklist">
              <!-- injected -->
              </ul>
              <div class="row gap">
                <button id="printPackBtn" class="btn">Save as PDF</button>
                <button id="resetPackBtn" class="btn ghost">Reset</button>
              </div>
            <small class="note">* Optional/Provided</small>
            <small class="note">[Note: Checklist saves for this session only and resets on re-login.]</small>
            </div>
          </section>
        </div>
      </dialog>

      <!-- Fits (popout) -->
      <article class="card small pop" data-open="fitsModal">
        <div class="inner">
           <div class="face front" style="--icon-w: 220px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/cloth.png" alt="Cloth">
          </div>
          <div class="face back center">
            <p>Tap to open</p>
          </div>
        </div>
      </article>

      <!-- FITS MODAL -->
      <dialog id="fitsModal" class="modal">
        <div class="modal-card" data-view="menu">
          <header class="modal-head">
            <button type="button" class="icon-btn back-btn hidden" data-back aria-label="Back">‚Üê</button>
            <h4>Fits ‚Äî Vision & Sizes</h4>
            <button type="button" class="close-modal" aria-label="Close">‚úï</button>
          </header>
          <section class="modal-body">
            <div id="fitsMenu">
              <div class="vision-grid">
                <button type="button" class="vision-item" data-vision="white">All-White Games Night </button>
                <button type="button" class="vision-item" data-vision="yacht">Sunkissed & Sailing</button>
                <button type="button" class="vision-item" data-vision="mi6">MI6: Night Ops</button>
                <button type="button" class="vision-item" data-vision="dinner">TribeAly Table</button>
                <button type="button" class="vision-item" data-vision="beach">Stripes on the Beach</button>
                <button type="button" class="vision-item" data-vision="travel">Comfort Travel</button>
              </div>
              <div class="size-header">For TribeAly Traditional Wear, Please Select Your Preferences Below</div>
              
              <!-- Bodice picker (auto-shown only for female via JS) -->
              <div id="bodicePicker" class="bodice-grid hidden" aria-label="Choose bodice styles">
                <!-- injected images via JS from assets/fits/neckline -->
              </div>

              <div class="sizes">
                <div id="sizeFields" class="size-fields"><!-- injected --></div>
                <button type="button" id="saveSizesBtn" class="btn">Save Sizes</button>
                <small id="sizeMsg" class="note"></small>

                <div id="sizeGuideWrapper" class="size-guide-wrapper">
                  <button id="toggleSizeGuide" class="link-btn" type="button">View Size Guide</button>

                  <div id="sizeGuideContent" class="size-guide hidden">
                    <div class="size-guide-controls">
                      <button id="unitToggle" class="toggle-btn" type="button">Switch to Inches</button>
                    </div>
                    <img id="sizeGuideImg" src="" alt="Size Guide" loading="lazy">
                  </div>
              </div>
            </div>
          </section>
          <!-- VIEWER VIEW -->
          <div id="fitsViewer" class="fits-viewer hidden">
            <img id="visionImg" alt="Visionboard" />
          </div>
        </div>
      </dialog>


      <!-- Music -->
      <article class="card small" data-card="music">
        <div class="inner">
          <div class="face front" style="--icon-w: 220px;">
            <img class="card-icon" src="assets/icons/music.png" alt="Music">
          </div>

          <div class="face back">
            <h3>Vibes</h3>
            <!-- Spinning vinyl + preview -->
            <div class="vinyl-wrap">
              <div class="vinyl" id="vinylDisc">
                <div class="label">
                  <span class="track">TribeAly 25¬∞</span>
                </div>
                <div class="hole"></div>
              </div>
              <audio id="vinylTrack" src="assets/music/whosdatgirl.mp3" loop preload="auto"></audio>
              <div class="vinyl-controls">
                <div class="play-pause">
                  <button type="button" id="playVinylBtn" class="btn small">‚ñ∂</button>
                <button type="button" id="pauseVinylBtn" class="btn ghost small">‚è∏Ô∏é</button>
                </div>
                <button type="button" id="openMusicModalBtn" class="btn" data-open="musicModal">Add to the Playlist</button>
                <small class="note" id="musicNote">Suggest up to 20 songs to be added to the event playlists!</small>
              </div>
            </div>
          </div>
        </div>
      </article>

      <!-- MUSIC PICKER MODAL -->
      <dialog id="musicModal" class="modal">
        <div class="modal-card">
          <header class="modal-head">
            <h4>Suggest Tracks</h4>
            <button class="close-modal" aria-label="Close">‚úï</button>
          </header>

          <section class="modal-body music-modal-body">
            <!-- Auth / status row -->
            <div class="music-auth hidden">
              <button type="button" class="btn ghost" id="spotifyAuthBtn">Connect Spotify</button>
              <span id="spotifyStatus" class="muted">Powered by Spotify</span>
            </div>

            <!-- Search -->
            <div class="music-search row gap">
              <input id="spotifyQuery" type="text" placeholder="Search songs or artists‚Ä¶" />
              <button type="button" class="btn" id="spotifySearchBtn">Search</button>
            </div>

            <!-- Results -->
            <div id="spotifyResults" class="track-results"><!-- injected --></div>

            <!-- Current picks -->
            <h5 class="music-subhead">Your Picks</h5>
            <ul id="pickList" class="pick-list"><!-- injected --></ul>

            <!-- Submit -->
            <div class="row gap">
              <button type="button" class="btn" id="submitPicksBtn">Submit Picks</button>
              <button type="button" class="btn ghost" id="clearPicksBtn">Clear Picks</button>
            </div>
            <small id="musicSubmitMsg" class="note"></small>
          </section>
        </div>
      </dialog>



      <!-- Middle 2x2 BIG: Day 1‚Äì4 -->
      <article class="card big" data-card="day1">
        <div class="inner">
           <div class="face front" style="--icon-w: 300px;"> <!--Big card-->
            <span class="card-kicker">DAY 1</span>
            <img class="card-icon" src="assets/icons/dice.png" alt="Dice">
          </div>
          <div class="face back">
            <img class="outline-flipped" src="assets/icons/cards_outline.png"/> 
            <div class="vision">Day 1 ‚Äî AT Club 25¬∞</div>
            <ul class="bullets">
              <li>2:00 - 3:00 PM ‚Ä¢ Rideshares to Villa</li>
              <li>3:00 PM ‚Ä¢ Arrival AT Villa, Welcome Drinks by the Pool</li>
              <li>5:00 - 6:00 PM ‚Ä¢ Group Gocery Run</li>
              <li>8:00 PM ‚Ä¢ Games Night - Dress Theme: All White</li>
            </ul>
            <img class="outline" src="assets/icons/cards_outline.png"/> 
          </div>
        </div>
      </article>

      <article class="card big" data-card="day2">
        <div class="inner">
          <div class="face front" style="--icon-w: 330px;"> <!--Big card-->
            <span class="card-kicker">DAY 2</span>
            <img class="card-icon" src="assets/icons/yacht.png" alt="Yacht">
          </div>
          <div class="face back">
             <img class="outline-flipped" src="assets/icons/yacht_outline.png"/> 
            <div class="vision">Day 2 ‚Äî AT Horizon 25¬∞</div>
            <ul class="bullets">
              <li>Optional Morning Swim</li>
              <li>Group Brunch Preparations</li>
              <li>2:00 - 6:00 PM ‚Ä¢ Sunkissed & Sailing (Yacht Day) - Dress Theme: Sunset</li>
              <li>11:00 PM ‚Ä¢ 25¬∞ AT Midnight (MI6: Night Ops) - Dress Theme: All Black</li>
            </ul>
             <img class="outline" src="assets/icons/yacht_outline.png"/> 
          </div>
        </div>
      </article>

      <article class="card big" data-card="day3">
        <div class="inner">
         <div class="face front" style="--icon-w: 330px;"> <!--Big card-->
            <span class="card-kicker">DAY 3</span>
            <img class="card-icon" src="assets/icons/candles.png" alt="Candles">
          </div>
          <div class="face back">
             <img class="outline-flipped" src="assets/icons/candle_outline.png"/> 
            <div class="vision">Day 3 ‚Äî AT TribeAly 25¬∞</div>
            <ul class="bullets">
              <li>11:00 AM - 3:00 PM ‚Ä¢ AT South Beach to Swim &/ Tan - Dress Theme: Green & White Stripes</li>
              <li>7:00 PM ‚Ä¢ Chef-made Dinner AT The Era - Dress Theme: Nigerian Attire (provided) </li>
            </ul>
             <img class="outline" src="assets/icons/candle_outline.png"/> 
          </div>
        </div>
      </article>

      <article class="card big" data-card="day4">
        <div class="inner">
          <div class="face front" style="--icon-w: 300px;"> <!--Big card-->
            <span class="card-kicker">DAY 4</span>
            <img class="card-icon" src="assets/icons/airplane.png" alt="airplane">
          </div>
          <div class="face back">
             <img class="outline-flipped" src="assets/icons/passport_outline.png"/> 
            <div class="vision">Day 4 ‚Äî AT The Airport</div>
            <ul class="bullets">
              <li>9:00 - 10:00 AM ‚Ä¢ Goodbyes, Staggered Rideshares </li>
            </ul>
             <img class="outline" src="assets/icons/passport_outline.png"/> 
          </div>
        </div>
      </article>

      <!-- Bottom 4 small -->
      <article class="card small" data-card="temp">
        <div class="inner">
           <div class="face front" style="--icon-w: 220px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/thermometer.png" alt="Thermometer">
          </div>
          <div class="face back center">
            <div class="meme">25¬∞C, it's HOT baby! </div>
          </div>
        </div>
      </article>

      <!-- GROCERIES -->
      <article class="card small pop" data-open="groceryModal">
        <div class="inner">
           <div class="face front" style="--icon-w: 220px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/champagne.png" alt="Champagne">
          </div>
          <div class="face back center">
            <p>Tap to open</p>
          </div>
        </div>
      </article>

      <!-- GROCERY MODAL -->
      <dialog id="groceryModal" class="modal">
        <form method="dialog" class="modal-card grocery">
        <header>
          <h3>Grocery List ‚Äî Add & Vote</h3>
          <button value="close" class="icon-btn" aria-label="Close">‚úï</button>
        </header>

        <div class="g-body">
          <!-- LEFT: add -->
          <section class="g-left">
            <label for="gItem" class="visually-hidden">Add a grocery item</label>
            <div class="row gap">
              <input id="gItem" type="text" placeholder="Add an item (e.g., sparkling water)" list="gAuto" autocomplete="off" />
              <button id="addGItemBtn" class="btn" type="button">Add</button>
            </div>
            <datalist id="gAuto"><!-- populated by JS --></datalist>
            <p class="limit-note"><span id="gRemaining">10</span> items remaining you can add.</p>
            <small class="note">Votes help shape shared costs. (Local only for now.)</small>
          </section>

          <!-- RIGHT: shared list -->
          <section class="g-right">
            <div class="g-toolbar">
              <strong>Shared List</strong>
              <select id="gSort">
                <option value="score">Sort: Score</option>
                <option value="new">Sort: Newest</option>
                <option value="alpha">Sort: A‚ÄìZ</option>
              </select>
            </div>

            <ul id="gList" class="grocery-list" aria-live="polite"><!-- injected --></ul>
            <p class="empty-hint" id="gEmpty" hidden>No items yet. Be the first to add one!</p>
          </section>
        </div>
      </form>
      </dialog>

      <!--Calendar Modal-->
      <article class="card small pop" data-open="calendarModal">
        <div class="inner">
           <div class="face front" style="--icon-w: 180px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/calendar.png" alt="Calendar">
          </div>
          <div class="face back center">
            <p>Tap to open</p>
          </div>
        </div>
      </article>

      <!-- CALENDAR MODAL -->
      <dialog id="calendarModal" class="modal">
        <form method="dialog" class="modal-card">
          <header>
            <h3>Important Dates & Times</h3>
            <button value="close" class="icon-btn" aria-label="Close">‚úï</button>
          </header>

          <div class="calendar-block" id="calendarPrintable">
            <ul class="bullets">
              <!-- Assuming trip is March 13‚Äì16, 2026. -->
              <!-- Assuming deposits relate to the upcoming trip: 2025 -> 2026. -->
              <li>Deposit 1 due: <b>Thu, Nov 20, 2025</b></li>
              <li>Deposit 2 due: <b>Wed, Dec 10, 2025</b></li>
              <li>Visa & Ticket Reminder: <b>Thu, Jan 1, 2026</b></li>

              <li>
                <div class="stack">
                  <b>Day 1 ‚Äî Fri, Mar 13, 2026 ‚Ä¢ Arrivals: 2-3 PM (every 30 min)</b>
                  <b>Day 2 ‚Äî Sat, Mar 14, 2026 ‚Ä¢ Yacht Day: 11 AM-1 PM (every 40 min)</b>
                  <b>Day 3 ‚Äî Sun, Mar 15, 2026 ‚Ä¢ Beach Day: 9-11 AM (every 40 min)</b>
                  <b>Day 4 ‚Äî Mon, Mar 16, 2026 ‚Ä¢ Departures: 5-10 AM (every 60 min)</b>
                </div>
              </li>
            </ul>

            <div class="row gap">
              <button id="downloadIcsBtn" class="btn" type="button">Download .ics</button>
              <button id="savePdfBtn" class="btn" type="button">Save as PDF</button>
            </div>
            <small class="note">Add to your calendar or save a PDF summary.</small>
          </div>
        </form>
      </dialog>


      <article class="card small" data-card="budget">
        <div class="inner">
           <div class="face front" style="--icon-w: 220px;"> <!--Small card-->
            <img class="card-icon" src="assets/icons/money.png" alt="Money">
          </div>
          <div class="face back">
            <div class="budget">
              <div class="row">
                <label>Currency</label>
                <select id="currencySelect">
                  <option value="USD">$ USD</option>
                  <option value="NGN">‚Ç¶ NGN</option>
                  <option value="GBP">¬£ GBP</option>
                  <option value="EUR">‚Ç¨ EUR</option>
                </select>
              </div>
              <div id="budgetTable" class="table"></div>
              <small class="note">Travel not included in base cost. Estimates provided for info only.</small>
            </div>
          </div>
        </div>
      </article>
    </section>

    <!-- RSVP -->
    <section class="rsvp">
      <h2>RSVP</h2>
      <form id="rsvpForm">
        <div class="row gap">
          <input id="rsvpName" type="text" placeholder="Your name" required />
          <input id="rsvpEmail" type="email" placeholder="Email" required />
          <label class="checkbox">
            <input id="rsvpRemind" type="checkbox" />
            <span>Email me reminders</span>
          </label>
        </div>
        <button class="btn primary">Submit RSVP</button>
        <small id="rsvpMsg" class="note"></small>
      </form>
    </section>
  </main>

  <footer class="footer">
    <span>¬© TribeAly ‚Ä¢ 25¬∞</span>
  </footer>
<script>
(() => {
  // ---------- CONFIG ----------
  const STORAGE_KEYS = {
    items: 'grocery_master_v1',     // [{id,name,score,createdAt,submitterId}]
    votes: 'grocery_votes_v1',      // {itemId: -1|0|1}
    myAdds: 'grocery_my_adds_v1',   // Set of itemIds I added
    userId: 'grocery_user_id_v1',   // uuid
  };
  const MY_ADD_LIMIT = 10;

  // A lightweight starter list; extend as you like.
  const SUGGESTIONS = [
    'apples','bananas','blueberries','strawberries','avocado','spinach','kale','arugula','broccoli',
    'carrots','cucumber','bell peppers','tomatoes','red onions','garlic','ginger','lemons','limes',
    'oranges','grapes','watermelon','pineapple','mango','peaches','plums',
    'eggs','whole milk','oat milk','almond milk','yogurt','butter','cheddar','mozzarella','feta',
    'chicken breast','ground beef','salmon','shrimp','tofu','tempeh','black beans','chickpeas','lentils',
    'rice','quinoa','spaghetti','penne','bread','tortillas','bagels','cereal','granola',
    'olive oil','canola oil','balsamic vinegar','soy sauce','hot sauce','ketchup','mustard','mayo',
    'salt','pepper','cinnamon','paprika','curry powder',
    'sparkling water','bottled water','orange juice','apple juice','coffee','tea',
    'chips','popcorn','crackers','hummus','salsa','nuts','chocolate',
    'toilet paper','paper towels','napkins','sponges','dish soap','laundry detergent'
  ];

  // ---------- STATE ----------
  const getUserId = () => {
    let id = localStorage.getItem(STORAGE_KEYS.userId);
    if (!id && window.crypto?.randomUUID) {
      id = crypto.randomUUID();
      localStorage.setItem(STORAGE_KEYS.userId, id);
    } else if (!id) {
      // fallback
      id = 'u_' + Math.random().toString(36).slice(2);
      localStorage.setItem(STORAGE_KEYS.userId, id);
    }
    return id;
  };
  const USER_ID = getUserId();

  const readJSON = (k, fallback) => {
    try { return JSON.parse(localStorage.getItem(k)) ?? fallback; }
    catch { return fallback; }
  };
  const writeJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));

  const getItems = () => readJSON(STORAGE_KEYS.items, []);
  const setItems = (arr) => writeJSON(STORAGE_KEYS.items, arr);

  const getVotes = () => readJSON(STORAGE_KEYS.votes, {}); // my votes only
  const setVotes = (obj) => writeJSON(STORAGE_KEYS.votes, obj);

  const getMyAdds = () => new Set(readJSON(STORAGE_KEYS.myAdds, []));
  const setMyAdds = (set) => writeJSON(STORAGE_KEYS.myAdds, [...set]);

  // ---------- DOM ----------
  const modal = document.querySelector('#groceryModal');
  const addBtn = modal.querySelector('#addGItemBtn');
  const input = modal.querySelector('#gItem');
  const list = modal.querySelector('#gList');
  const emptyHint = modal.querySelector('#gEmpty');
  const sortSel = modal.querySelector('#gSort');
  const remainingEl = modal.querySelector('#gRemaining');
  const datalist = modal.querySelector('#gAuto');

  // populate datalist
  const renderSuggestions = () => {
    datalist.innerHTML = SUGGESTIONS
      .sort((a,b) => a.localeCompare(b))
      .map(s => `<option value="${escapeHTML(s)}"></option>`).join('');
  };

  // helpers
  const escapeHTML = (s='') => s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const normalize = (s) => s.trim().replace(/\s+/g,' ').toLowerCase();

  const updateRemaining = () => {
    const mine = getMyAdds();
    remainingEl.textContent = Math.max(0, MY_ADD_LIMIT - mine.size);
  };

  // add item flow
  const addItem = (raw) => {
    const nameRaw = raw ?? input.value;
    const name = nameRaw.trim();
    if (!name) return;
    const norm = normalize(name);
    const items = getItems();

    // prevent duplicates (case-insensitive)
    if (items.some(it => normalize(it.name) === norm)) {
      // optionally surface a tiny shake animation or toast
      input.value = '';
      return render(); // already exists, just re-render
    }

    // enforce per-user limit
    const mine = getMyAdds();
    if (mine.size >= MY_ADD_LIMIT) {
      // show a note? up to you
      return;
    }

    const id = (crypto.randomUUID?.() ?? ('i_' + Math.random().toString(36).slice(2)));
    const now = Date.now();
    const newItem = { id, name, score: 0, createdAt: now, submitterId: USER_ID };

    setItems([newItem, ...items]);   // newest first
    mine.add(id);
    setMyAdds(mine);
    input.value = '';
    render();
  };

  // voting
  const vote = (itemId, dir) => {
    // dir: +1 or -1
    const items = getItems();
    const item = items.find(i => i.id === itemId);
    if (!item) return;

    const myVotes = getVotes();
    const prev = myVotes[itemId] ?? 0; // -1, 0, +1

    let next = dir;
    // toggle if same direction clicked again
    if (prev === dir) next = 0;

    // adjust score
    item.score += (next - prev);
    myVotes[itemId] = next;

    setItems(items);
    setVotes(myVotes);
    render();
  };

  // sorters
  const sortFns = {
    score: (a,b) => (b.score - a.score) || a.name.localeCompare(b.name),
    new:   (a,b) => b.createdAt - a.createdAt,
    alpha: (a,b) => a.name.localeCompare(b.name)
  };

  // render list
  const render = () => {
    const items = getItems().slice();
    const myVotes = getVotes();

    const sortBy = sortSel.value || 'score';
    items.sort(sortFns[sortBy]);

    list.innerHTML = items.map(it => {
      const my = myVotes[it.id] ?? 0;
      const upPressed = my === 1 ? 'true' : 'false';
      const dnPressed = my === -1 ? 'true' : 'false';
      return `
        <li class="grocery-item" data-id="${it.id}">
          <div class="votes">
            <button class="vote-btn up" aria-label="Upvote" aria-pressed="${upPressed}">‚ñ≤</button>
            <div class="score" aria-label="Score">${it.score}</div>
            <button class="vote-btn dn" aria-label="Downvote" aria-pressed="${dnPressed}">‚ñº</button>
          </div>
          <div>
            <div class="name">${escapeHTML(it.name)}</div>
            <div class="meta">${it.submitterId === USER_ID ? 'added by you' : 'shared'}</div>
          </div>
          <div></div>
        </li>
      `;
    }).join('');

    emptyHint.hidden = items.length > 0;
    updateRemaining();
  };

  // events
  addBtn.addEventListener('click', () => addItem());
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') { e.preventDefault(); addItem(); }
  });

  list.addEventListener('click', (e) => {
    const li = e.target.closest('.grocery-item');
    if (!li) return;
    const id = li.getAttribute('data-id');
    if (e.target.classList.contains('up')) vote(id, +1);
    if (e.target.classList.contains('dn')) vote(id, -1);
  });

  sortSel.addEventListener('change', render);

  // open hook ‚Äî if you already have dialog open logic, this just refreshes content when shown
  modal.addEventListener('close', () => {
    // optional: save/flush here
  });
  modal.addEventListener('cancel', () => {}); // esc

  // If your open code calls dialog.showModal(), also call the two below once on page load:
  renderSuggestions();
  render();

  // ---------- BACKEND HOOKS (Supabase later) ----------
  // Replace getItems/setItems, getVotes/setVotes, getMyAdds/setMyAdds with async
  // calls to your Supabase tables:
  //
  // Table: groceries
  //   id (uuid) | name (text unique ci) | score (int) | created_at (timestamptz) | submitter_id (text)
  // Table: grocery_votes
  //   item_id (uuid) | user_id (text) | value (smallint)  -- unique (item_id, user_id)
  //
  // On add: insert groceries row; insert into "my adds" if you keep it server-side or enforce via policy.
  // On vote: upsert into grocery_votes; update groceries.score = sum(votes.value).
  // NOTE: You‚Äôll also enforce ‚Äú<=10 adds per user‚Äù with a policy/trigger.
})();
</script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  window.supabase = supabase.createClient(
    'https://ehpezdokajybatjnzdsp.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVocGV6ZG9rYWp5YmF0am56ZHNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NTc0NzgsImV4cCI6MjA3NDMzMzQ3OH0.SWMGFQk0cPdu-uj59yPUn2Y1GW8MXQIfo0aT8cVUju8'
  );
</script>
<script>
  window.SPOTIFY_CLIENT_ID = "82dcd985b0a149809e9eb10ea968edbd"; 
</script>
<script src="script.js"></script>
</body>
</html>
